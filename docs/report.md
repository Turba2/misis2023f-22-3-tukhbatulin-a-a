**Формат файла – PNG**

PNG (сокращение от Portable Graphic Network) - это растровое изображение, которое имеет следующую структуру:

![](media/27271b1f3b351fcce0b116347ec333b0.png)

Рисунок 1

**PNG signature (описание)**

Подпись PNG-файла всегда одинакова, состоит из 8 байт, и представляет собой: 89 50 4E 47 0D 0A 1A 0A, где:

-   89 — non-ASCII символ. Препятствует распознаванию PNG, как текстового файла, и наоборот.
-   50 4E 47 — PNG в ASCII записи.
-   0D 0A — CRLF (Carriage-return, Line-feed), DOS-style перевод строки.
-   1A — останавливает вывод файла в DOS режиме (end-of-file), чтобы вам не вываливалось многокилобайтное изображение в текстовом виде.
-   0A — LF, Unix-style перевод строки.

**Chunks (блоки)**

Чанки — это блоки данных, из которых состоит файл. Каждый чанк состоит из 4 секций.

![](media/37d4e019983a9a34d424a3a0a9484290.png)

Рисунок 2

Если с длинной все понятно, то типы нужно стоит рассмотреть подробнее.

Тип чанка в файле PNG состоит из четырех букв, каждая из которых имеет свой смысл. Регистры символов (верхний или нижний регистр буквы) сообщают декодеру дополнительную информацию.

-   Первая буква определяет важность чанка: если она написана заглавными буквами, это критически важный чанк, который должен быть понят любым декодером.
-   Вторая буква указывает, является ли чанк общедоступным или частным; общедоступные чанки распознаются большинством программ, а если вы хотите сохранить что-то личное, используйте строчные буквы.
-   Третья буква предназначена для будущего использования и сейчас используется для отличия разных версий формата.
-   Четвертая буква определяет, можно ли копировать этот чанк, если его не распознают. Если она написана строчными буквами, чанк может быть скопирован, независимо от изменений файла, в то время как заглавные буквы требуют сохранения чанка только при сохранении критических частей файла без изменений.

А CRC является контрольной суммой.

**Минимальный PNG**

**![](media/a48326179d080353fde1784a1bfbbf4a.png)**

Рисунок 3

Обязательные чанки в файле PNG это те, которые не обязаны быть критическими, но должны присутствовать в каждом файле. Рассмотрим их:

Блок данных в IHDR содержит следующие параметры:

-   Ширина изображения (4 байта)
-   Высота изображения (4 байта)
-   Битовая глубина (количество бит на сэмпл, 1 байт)
-   Тип цвета (палитра, цветное изображение, альфа-канал; 1 байт)
-   Метод сжатия (0 - только deflate, иначе декодер сообщит об ошибке; 1 байт)
-   Метод фильтрации (0 - единственный доступный вариант; 1 байт)
-   Метод интерлейса (порядок передачи данных: 0 - без интерлейса, 1 - Adam7 интерлейс; 1 байт)

IDAT — содержит, собственно, изображение. Рисунок можно разбить на несколько IDAT чанков, для потоковой передачи. В каждом файле должен быть хотя бы один IDAT чанк.

IEND — завершающий чанк, обязан быть последним в файле.

**Применение и недостатки**

Формат файла PNG применяется для растровых изображений, особенно для веб-графики с прозрачностью и высоким качеством.

Его преимущества:

-   Прозрачность: Поддерживает альфа-канал для прозрачного фона.
-   Широкий цветовой спектр: Может отображать множество цветов с 24-битной глубиной.
-   Сжатие без потерь: Сохраняет качество изображения при относительно небольшом размере файла.
-   Метаданные: Позволяет встраивать дополнительную информацию.

Недостатки:

-   Больший размер файлов по сравнению с другими форматами.
-   Неэффективность для фотографий с большим количеством цветов.
-   Не поддерживает анимацию.

**Работа с файлами PNG в C++**

В C++ для работы с файлами формата PNG можно использовать библиотеки, такие как libpng, которые обеспечивают доступ к функциям чтения, записи и обработки изображений в формате PNG.

Пример использования библиотеки libpng:

Для чтения изображения:

-   Открыть файл PNG с помощью функций png_create_read_struct() и png_create_info_struct().
-   Использовать функции png_set_... для настройки параметров чтения (например, размеры изображения).
-   Считать изображение с использованием png_read_image().

Для записи изображения:

-   Создать файл PNG с помощью функций png_create_write_struct() и png_create_info_struct().
-   Настроить параметры изображения (размеры, глубину цвета, тип сжатия и т.д.) с помощью png_set_... функций.
-   Записать изображение с использованием png_write_image()
